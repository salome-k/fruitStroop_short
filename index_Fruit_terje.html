<html>
	<head>
		<title>Fruit Stroop Task</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="jspsych-5.0.3-fruit/jspsych.js"></script>

		<script src="jspsych-5.0.3-fruit/plugins/jspsych-text.js"></script>
		
		<script src="jspsych-5.0.3-fruit/plugins/jspsych-instructions.js"></script>
		
		<script src="jspsych-5.0.3-fruit/plugins/jspsych-survey-text_persCode.js"></script>
		<script src="jspsych-5.0.3-fruit/plugins/jspsych-button-response.js"></script>
		<script src="jspsych-5.0.3-fruit/plugins/jspsych-button-response-Fruit.js"></script>
		<script src="jspsych-5.0.3-fruit/plugins/jspsych-survey-multi-choice.js"></script>
		<script src="jspsych-5.0.3-fruit/plugins/jspsych-single-stim.js"></script>
		
		<link href="jspsych-5.0.3-fruit/css/jspsych_fruit.css" rel="stylesheet" type="text/css"></link>
		
		<style>
			:root{
				--normalTextSize: 20px;
				--cellSize_symMat: 40px;
				--cellSize_remMat: 60px;
				--numberSize_remMat: 40px;
			}
		</style>

	</head>
	
	
	<script>
	// helper functions
	function scrollWin() {window.scrollTo(0, 0);};

	var geoShapes = [ 
		['jspsych-5.0.3-fruit/Shapes/pentagon_yellow.png','jspsych-5.0.3-fruit/Shapes/pentagon_green.png','jspsych-5.0.3-fruit/Shapes/pentagon_red.png','jspsych-5.0.3-fruit/Shapes/pentagon_blue.png'],
		['jspsych-5.0.3-fruit/Shapes/triangle_yellow.png','jspsych-5.0.3-fruit/Shapes/triangle_green.png','jspsych-5.0.3-fruit/Shapes/triangle_red.png','jspsych-5.0.3-fruit/Shapes/triangle_blue.png'],
		['jspsych-5.0.3-fruit/Shapes/circle_yellow.png','jspsych-5.0.3-fruit/Shapes/circle_green.png','jspsych-5.0.3-fruit/Shapes/circle_red.png','jspsych-5.0.3-fruit/Shapes/circle_blue.png'],
		['jspsych-5.0.3-fruit/Shapes/parallelogram_yellow.png','jspsych-5.0.3-fruit/Shapes/parallelogram_green.png','jspsych-5.0.3-fruit/Shapes/parallelogram_red.png','jspsych-5.0.3-fruit/Shapes/parallelogram_blue.png']
	];
	var congruentFruits = [
		['jspsych-5.0.3-fruit/Fruits/banana_yellow.png','jspsych-5.0.3-fruit/Fruits/pear_green.png','jspsych-5.0.3-fruit/Fruits/strawberry_red.png','jspsych-5.0.3-fruit/Fruits/grapes_blue.png']
	];
	var transparentFruits = [ 
		['jspsych-5.0.3-fruit/Fruits/banana_transparent.png','jspsych-5.0.3-fruit/Fruits/pear_transparent.png','jspsych-5.0.3-fruit/Fruits/strawberry_transparent.png','jspsych-5.0.3-fruit/Fruits/grapes_transparent.png']
	];
	var incongruentFruits = [
		['jspsych-5.0.3-fruit/Fruits/banana_green.png','jspsych-5.0.3-fruit/Fruits/pear_red.png','jspsych-5.0.3-fruit/Fruits/strawberry_blue.png','jspsych-5.0.3-fruit/Fruits/grapes_yellow.png'],
		['jspsych-5.0.3-fruit/Fruits/banana_red.png','jspsych-5.0.3-fruit/Fruits/pear_blue.png','jspsych-5.0.3-fruit/Fruits/strawberry_yellow.png','jspsych-5.0.3-fruit/Fruits/grapes_green.png'],
		['jspsych-5.0.3-fruit/Fruits/banana_blue.png','jspsych-5.0.3-fruit/Fruits/pear_yellow.png','jspsych-5.0.3-fruit/Fruits/strawberry_green.png','jspsych-5.0.3-fruit/Fruits/grapes_red.png']

	];

	function averageFx(x){
		sum_x=0
		for(i=0;i<x.length;i++){
			sum_x=sum_x+x[i]
		}
		average_x = sum_x/x.length
		return(average_x)
	}

	var trials = [4,4,4];
	var practice_criterion = 3;
	var time_limit = 45000;
	//var time_limit = 5000;
///////// Intro
/////////
	var welcome = {
			type: 'instructions',
			pages: [
					"<p class='center-content'> <h2> Სალამი! Ეს ხილის ამოცანაა!</b></h2> Ამ ამოცანის ამოსახსნელად მხოლოდ 8 წუთი დაგჭირდებათ. <p><li>Გთხოვთ, არ გამოიყენოთ Windows Internet Explorer-ი, შესაძლოა პასუხები წაიშალოს. <li>Გთხოვთ, შემთხვევით არ დააწკაპუნოთ Escape ღილაკზე, ეს დავალებას პასუხების გარეშე შეინახავს.<p>დააწკაპუნეთ “გაგრძელება”-ზე შემდგომი ინსტრუქციების მისაღებად."],
			show_clickable_nav: true,
			
			};


    /* var informedConsent1 = {
		type: 'survey-multi-choice',
		questions: ["<b>N&#245usolek uuringus osalemiseks </b>1/3"],
		options: [["Olen &#252lesande kirjelduse l&#228bi lugenud ja n&#245ustun osalema."]],
		required: [true]
    };
	var informedConsent2 = {
		type: 'survey-multi-choice',
		questions: ["<b>N&#245usolek uuringus osalemiseks </b>2/3"],
		options: [["Olen n&#245us, et minu anon&#252&#252mseid andmeid kasutatakse teadusartiklite avaldamisel."]],
		required: [true]
    };
    var informedConsent3 = {
		type: 'survey-multi-choice',
		questions: ["<b>N&#245usolek uuringus osalemiseks </b>3/3"],
		options: function(){return([["Olen n&#245us, et teaduse l&#228bipaistvuse huvides tehakse mu anon&#252&#252msed andmed teistele teadlastele vabalt k&#228ttesaadavaks vastavalt Avatud Teaduse Raamistikule (vt <a href='https://osf.io/'> Open Science Framework</a>)."]])},
		required: [true]
    };*/

	var persData_code = ["<p> Შექმენით თქვენი ანონიმური პერსონალური კოდი:"];
	var demographics = {
	  		type: "survey-text-persCode",
	  		questions: persData_code,
			preamble: "<b>Ინსტრუქციები პერსონალური კოდის შესაქმნელად</b>: <br> Პირველი სიმბოლო: თქვენი სახელის მეორე ასო (მაგ., ლ<b>ე</b>ილა)<br>Მეორე სიმბოლო:თქვენი გვარის მესამე ასო (მაგ., ნუ<b>რ</b>იევა) <br> Თქვენი ტელეფონის ნომრის ბოლო ორი ციფრი (მაგ., 5376<b>92</b>) <p> Პერსონალური კოდის ნიმუში: <b>ერ92</b>",
			on_finish: function(data) { 
		 		code_length = data.code_length;
		 		if(code_length!=4){alert("გთხოვთ შეიყვანოთ თქვენი პერსონალური კოდი.")}
		 	}
	};
	var persCode_loop = {
		timeline: [demographics],
		loop_function: function(data){
				if(code_length!=4){
		            return true;
		        } else {
		            return false;
		        }
		  },
	};
///////// Page 1
	var Instruction_Page1 = {
		type: 'instructions',
		pages: ["Ხილის ამოცანა მოიცავს  შემდეგ <b>ოთხ დავალებას</b>: <p> <b>(ა)</b> გეომეტრიული ფიგურების ფერების დასახელება (ანუ აჭერთ შესაბამისი ფერის ღილაკზე). Მაგალითად, “მწვანე” ქვემოთ მოცემული ფიგურისთვის.  <br><img src='jspsych-5.0.3-fruit/Shapes/pentagon_green.png' width='80px'> <p><b>(ბ)</b> ხილის სურათების ფერების მითითება (“წითელი” ქვემოთ მოცემულ მაგალითში). <br><img src='jspsych-5.0.3-fruit/Fruits/strawberry_red.png' width='100px'><p><b>(გ)</b>  “ნამდვილი” ფერების მითითება ხილის შავ-თეთრი სურათებისთვის (“წითელი” ქვემოთ მოცემულ მაგალითში).<br><img src='jspsych-5.0.3-fruit/Fruits/strawberry_transparent.png' width='100px'> <p><b>(დ)</b> “ნამდვილი” ფერების მითითება ხილის მცდარ ფერებში ასახული სურათებისთვის (“წითელი” ქვემოთ მოცემულ მაგალითში).<br><img src='jspsych-5.0.3-fruit/Fruits/strawberry_blue.png' width='100px'> <p> <b> Ეცადეთ დავალება რაც შეიძლება სწრაფად და ზუსტად შეასრულოთ.  </b><p>Თითოეულ მათგანს წინ უძღვის პატარა სავარჯიშო ტესტი რომელშიც ზედიზედ  "+practice_criterion+" სწორი პასუხი უნდა მიუთითოთ. <p>***</p>Პირველი დავალების სავარჯიშო ტესტის დასაწყებად Დააწკაპუნეთ <i>გაგრძელება-ზე</i>."],
		show_clickable_nav: true,
		on_finish: function(data){
				i = 0;	
				practice = true
				shapes_practice = [0,1,2,3]
				colors_practice = [0,1,2,3]
				//i_shape = Math.floor(Math.random()*4)
				//i_color = Math.floor(Math.random()*4)
				i_shape = shapes_practice[0]
				i_color = colors_practice[0]
				button_pressed = Math.floor(Math.random()*4)
				practice = true
				nC_inarow = 0
				startTime = new Date()

				item_completed = false
				nCompleted_Page1 = i
				nErrors_Page1 = 0
				RTs_Page1 = []
				RTs_Page1_correct = []
				RTs_Page1_wrong = []
	 	   	},
	};
	
	var color_buttons = [ [""] , [""] , [""] , [""] ];
	var Page1 = {
		    type: 'BRFruit',
			is_html: false, 
			prompt: "Რა ფერია ეს ფიგურა?<p>",

			stimulus: function(){
					return geoShapes[i_shape][i_color]
			},
			
		    choices: color_buttons,
	 	   	on_finish: function(data){
				
				button_pressed = data.button_pressed
				button_order = data.button_order
				color_correct = data.color_correct
				color_clicked = data.color_clicked

				RTs_Page1.push(data.rt)
				if(color_correct==color_clicked){
					// i = counting items = number completed
					i++
					nCompleted_Page1=i
					nC_inarow++
					item_completed = true
					
					if(practice==false){
						var stim_turned_new = false;
						while(stim_turned_new == false){
							i_shape_next = Math.floor(Math.random()*color_buttons.length)
							i_color_next = Math.floor(Math.random()*color_buttons.length)	
							if((i_shape_next!= i_shape)&&(i_color_next!=i_color)){
								i_shape=i_shape_next
								i_color=i_color_next
								stim_turned_new=true
							}
						}
					}else{
						i_shape = shapes_practice[i]
						i_color = colors_practice[i]
					}

					RTs_Page1_correct.push(data.rt)
				}else{
					if(practice==true){i=0}
					nC_inarow = 0
					item_completed = false
					nErrors_Page1++
					RTs_Page1_wrong.push(data.rt)
				}
				
	 	   	},
		};
	var Feedback_Page1 = {
		type: 'instructions',
		pages: function(){if(item_completed==true){
			feedback_text = "<p>***</p> <span style='color:green'>სწორი პასუხია!</span><br>Თანმიმდევრულად მოცემული სწორი პასუხების რაოდენობა: <b>"+nC_inarow +"</b> (სულ <b>"+practice_criterion+"</b> დავალებაა).<p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."}else{
				feedback_text="<p>***</p> <span style='color:red'>Არასწორი პასუხია!</span> ღილაკის ფერი სურათის ფერს უნდა ემთხვეოდეს. Კიდევ ერთხელ სცადეთ!<br>Მოცემული სწორი პასუხები: <b>"+nC_inarow +"</b> (სულ <b>"+practice_criterion+"</b> დავალება).<p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."
			}
		 return[feedback_text]},
		show_clickable_nav: true,
		on_finish: function(data){
				
	 	   	},
	};
	var StimLoop_Page1_Practice = {
		timeline: [Page1,Feedback_Page1],
		loop_function: function(data){
			if(item_completed==true){
				return false
			}else{
				return true
			}
		}
	}
	var Page1_Loop_Practice = {
		timeline: [StimLoop_Page1_Practice],
		loop_function: function(data){
		        
		        if(nC_inarow==practice_criterion){
		        	return false;
		        }else{
		        	return true;
		        }

		  }

	}
	var Filler_Page1 = {
		type: 'instructions',
		pages: ["<p>***</p> <b>ყოჩაღ!</b> <br>Ახლა კი მზად ხარ შეასრულო <b>1</b>. დავალება (სულ <b>4</b> დავალებაა). <p>Სურათები ისევეა წარმოდგენილი როგორც სავარჯიშო ტესტში იყო. Ახალი სურათი მაშინ გამოჩნდება, თუ წინა პასუხი სწორი იყო. Თუმცა ეკრანზე აღარ იქნება მითითებული, სწორია თუ არა გაცემული პასუხი. <b><br>ამოცანი შესრულებას "+(time_limit/1000)+" წამი სჭირდება და თქვენი მიზანია რაც შეიძლება მეტ დავალებას უპასუხოთ!</b></p><p>***</p>Დასაწყებად Დააწკაპუნეთ <i>გაგრძელება-ზე</i>."],
		show_clickable_nav: true,
		on_finish: function(data){
				practice = false;
				i = 0;	
				i_shape = Math.floor(Math.random()*color_buttons.length)
				i_color = Math.floor(Math.random()*color_buttons.length)
				button_pressed = Math.floor(Math.random()*4)
				practice = false
				nC_inarow = 0
				startTime = new Date()

				item_completed = false
				nCompleted_Page1 = i
				nErrors_Page1 = 0
				RTs_Page1 = []
				RTs_Page1_correct = []
				RTs_Page1_wrong = []
	 	   	},
	};
	var StimLoop_Page1_Test = {
		timeline: [Page1],
		loop_function: function(data){
			if(item_completed==true){
				return false
			}else{
				return true
			}
		}
	}
	var Page1_Loop_Test = {
		timeline: [StimLoop_Page1_Test],
		loop_function: function(data){
		        
		        if((new Date()-startTime)>=time_limit){
		        	return false;
		        }else{
		        	return true;
		        }

		  }

	}

	var Page1_finalFeedback = {
		type: 'instructions',
		pages: function(){
				mean_RTs = Math.round((averageFx(RTs_Page1)/1000)*100)/100; nCompleted_Page1 = nCompleted_Page1;
				if(RTs_Page1_correct.length==0){mean_RTs_right="სწორი პასუხები არ არის"}else{
					mean_RTs_right_P1 = Math.round((averageFx(RTs_Page1_correct)/1000)*100)/100; 
				}
				if(RTs_Page1_wrong.length==0){mean_RTs_wrong="არასწორი პასუხები არ არის"}else{
					mean_RTs_wrong = Math.round((averageFx(RTs_Page1_wrong)/1000)*100)/100; 
				}
				return["Შესრულებული დავალებების რაოდენობა <b>"+nCompleted_Page1+"</b><br>Შეცდომების რაოდენობა:<b>"+nErrors_Page1+"</b><br>Პასუხის საშუალო დრო(წამი): <b>"+mean_RTs+"</b><br>Პასუხის დრო(სწორი მცდელობები): <b>"+mean_RTs_right_P1+" </b><br>Პასუხის დრო(არასწორი მცდელობები):  <b>"+mean_RTs_wrong+" "]},
		show_clickable_nav: true,
		data: function(){
				return{nCompleted_Page1: nCompleted_Page1, nErrors_Page1: nErrors_Page1, RTs: RTs_Page1}
			},
		on_finish: function(data){
				
	 	   	},
	}

	var Instruction_Page2 = {
		type: 'instructions',
		pages: ["<p>***</p> <b> კარგია!</b> <p>სანამ <b>მეორე</b> დავალებას შეასრულებთ(სულ <b>ოთხია</b>) კიდევ ერთ სავარჯიშო ტესტში ზედიზედ "+practice_criterion+" სწორი პასუხი უნდა გასცეთ. <p>***</p>ტესტის დასაწყებად დააწკაპუნეთ <i>გაგრძელება-ს</i>."],
		show_clickable_nav: true,
		on_finish: function(data){
				practice=true;
				i = 0;	
				//i_color = Math.floor(Math.random()*color_buttons.length)
				colors_practice = [0,1,2,3]
				i_color = colors_practice[0]
				button_pressed = Math.floor(Math.random()*4)
				practice = true
				nC_inarow = 0
				startTime = new Date()

				item_completed = false
				nCompleted_Page2 = i
				nErrors_Page2 = 0
				RTs_Page2 = []
				RTs_Page2_correct = []
				RTs_Page2_wrong = []

	 	   	},
	};
	var Page2 = {
		    type: 'BRFruit',
			is_html: false, 
			prompt: "რა ფერია ხილი? <p>",
			stimulus: function(){
					return congruentFruits[0][i_color]
			},
		    choices: color_buttons,
	 	   	on_finish: function(data){
				button_order = data.button_order
				button_pressed = data.button_pressed
				color_correct = data.color_correct
				color_clicked = data.color_clicked
				console.log([color_correct,color_clicked])
				RTs_Page2.push(data.rt)
				if(color_correct==color_clicked){
					i++
					nCompleted_Page2=i
					nC_inarow++
					item_completed = true
					if(practice==false){
						var stim_turned_new = false;
						while(stim_turned_new== false){
							i_color_next = Math.floor(Math.random()*color_buttons.length)	
							if(i_color_next!= i_color){
								i_color=i_color_next
								stim_turned_new=true
							}
						}
					}else{
						i_color = colors_practice[i]
					}
					RTs_Page2_correct.push(data.rt)
				}else{
					if(practice==true){i=0}
					nC_inarow = 0
					item_completed = false
					nErrors_Page2++
					RTs_Page2_wrong.push(data.rt)
				}

				
	 	   	},
		};

	var Feedback_Page2 = {
		type: 'instructions',
		pages: function(){if(item_completed==true){
			feedback_text = "<p>***</p> <span style='color:green'>სწორი პასუხია!</span><br> Თანმიმდევრულად მოცემული სწორი პასუხების რაოდენობა: <b>"+nC_inarow +"</b> (სულ <b>"+practice_criterion+"</b> დავალებაა).<p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."}else{
				feedback_text="<p>***</p> <span style='color:red'>არასწორი პასუხია!</span> Ღილაკის ფერი ხილის ფერს უნდა ემთხვეოდეს. Კიდევ ერთხელ სცადეთ!<br> მოცემული სწორი პასუხები: <b>"+nC_inarow +"</b> (სულ <b>"+practice_criterion+"</b> დავალებაა).<p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."
			}
		 return[feedback_text]},
		show_clickable_nav: true,
		on_finish: function(data){
				
	 	   	},
	};
	var StimLoop_Page2_Practice = {
		timeline: [Page2,Feedback_Page2],
		loop_function: function(data){
			if(item_completed==true){
				return false
			}else{
				return true
			}
		}
	}
	var Page2_Loop_Practice = {
		timeline: [StimLoop_Page2_Practice],
		loop_function: function(data){
		        
		        if(nC_inarow==practice_criterion){
		        	return false;
		        }else{
		        	return true;
		        }

		  }

	}
	var Filler_Page2 = {
		type: 'instructions',
		pages: ["<p>***</p> <b>ძალიან კარგი!</b> <p>ახლა დროა შეასრულოთ დავალება <b>2</b>. (სულ არის <b>4</b>). <b><br>შეასრულეთ "+(time_limit/1000)+" წამში რაც შეიძლება მეტი ხილის ამოცანა!</b></p><p>***</p>ტესტის დასაწყებად დააწკაპუნეთ <i>გაგრძელება-ს</i>."],
		show_clickable_nav: true,
		on_finish: function(data){
				practice=false;
				i = 0;	
				i_color = Math.floor(Math.random()*color_buttons.length)
				button_pressed = Math.floor(Math.random()*color_buttons.length)
				practice = false
				nC_inarow = 0
				startTime = new Date()

				item_completed = false
				nCompleted_Page2 = i
				nErrors_Page2 = 0
				RTs_Page2 = []
				RTs_Page2_correct = []
				RTs_Page2_wrong = []
	 	   	},
	};
	var StimLoop_Page2_Test = {
		timeline: [Page2],
		loop_function: function(data){
			if(item_completed==true){
				return false
			}else{
				return true
			}
		}
	}
	var Page2_Loop_Test = {
		timeline: [StimLoop_Page2_Test],
		loop_function: function(data){
		        
		        if((new Date()-startTime)>=time_limit){
		        	return false;
		        }else{
		        	return true;
		        }

		  }

	}

	var Page2_finalFeedback = {
		type: 'instructions',
		pages: function(){
				mean_RTs = Math.round((averageFx(RTs_Page2)/1000)*100)/100; nCompleted_Page2 = nCompleted_Page2;
				if(RTs_Page2_correct.length==0){mean_RTs_right="სწორი პასუხები არ არის"}else{
					mean_RTs_right_P2 = Math.round((averageFx(RTs_Page2_correct)/1000)*100)/100; 
				}
				if(RTs_Page2_wrong.length==0){mean_RTs_wrong="არასწორი პასუხები არ არის"}else{
					mean_RTs_wrong = Math.round((averageFx(RTs_Page2_wrong)/1000)*100)/100; 
				}
				return["შესრულებული დავალებები: <b>"+nCompleted_Page2+"</b><br>შეცდომების რაოდენობა: <b>"+nErrors_Page2+"</b><br>საშუალო პასუხის დრო(წამი): <b>"+mean_RTs+"</b><br>პასუხის დრო(სწორი მცდელობები): <b>"+mean_RTs_right_P2+" </b><br>პასუხის დრო(არასწორი მცდელობები): <b>"+mean_RTs_wrong+" "]},
		show_clickable_nav: true,
		data: function(){
				return{nCompleted_Page2: nCompleted_Page2, nErrors_Page2: nErrors_Page2, RTs: RTs_Page2}
			},
		on_finish: function(data){
				
	 	   	},
	}

	var Instruction_Page3 = {
		type: 'instructions',
		pages: ["<p>***</p> <b>ყოჩაღ!</b> <p> უკვე <b>მესამე</b> დავალებაზე ხართ (სულ <b>ოთხი</b> დავალებაა). Ახლა იგივე ხილი (ბანანი, მსხალი, მარწყვი, ყურძენი) შავ-თეთრ ფერებში იქნება წარმოდგენილი და თქვენი ამოცანაა სწორი ფერი ამოარჩიოთ ვარიანტებიდან ანუ ირჩევთ ყვითელს ბანანისთვის, მწვანეს მსხლისთვის, წითელს მარწყვისთვის და ლურჯს ყურძნისთვის. <p>***</p>ტესტის დასაწყებად დააწკაპუნეთ <i>გაგრძელება-ს</i>."],
		show_clickable_nav: true,
		on_finish: function(data){
				i = 0;	
				// i_color = Math.floor(Math.random()*color_buttons.length)
				colors_practice = [0,1,2,3]
				i_color = colors_practice[0]
				button_pressed = Math.floor(Math.random()*color_buttons.length)
				practice = true
				nC_inarow = 0
				startTime = new Date()

				item_completed = false
				nCompleted_Page3 = i
				nErrors_Page3 = 0
				RTs_Page3 = []
				RTs_Page3_correct = []
				RTs_Page3_wrong = []
	 	   	},
	};
	var Page3 = {
		    type: 'BRFruit',
			is_html: false, 
			prompt: "რა ფერია ეს ხილი?<p>",
			stimulus: function(){
					return transparentFruits[0][i_color]
			},
		    choices: color_buttons,
	 	   	on_finish: function(data){
				button_order = data.button_order
				button_pressed = data.button_pressed
				color_correct = data.color_correct
				color_clicked = data.color_clicked
				RTs_Page3.push(data.rt)
				if(color_correct==color_clicked){
					// i = counting items = number completed
					i++
					nCompleted_Page3=i
					nC_inarow++
					item_completed = true
					if(practice==false){
						var stim_turned_new = false;
						while(stim_turned_new== false){
							i_color_next = Math.floor(Math.random()*color_buttons.length)	
							if(i_color_next!=i_color){
								i_color=i_color_next
								stim_turned_new=true
							}
						}
					}else{
						i_color = colors_practice[i]
					}
					RTs_Page3_correct.push(data.rt)
				}else{
					if(practice==true){i=0}
					nC_inarow = 0
					item_completed = false
					nErrors_Page3++
					RTs_Page3_wrong.push(data.rt)
				}
	 	   	},
		};

	var Feedback_Page3 = {
		type: 'instructions',
		pages: function(){if(item_completed==true){
			feedback_text = "<p>***</p> <span style='color:green'>სწორი პასუხია!</span><br>Თანმიმდევრულად მოცემული სწორი პასუხების რაოდენობა: <b>"+nC_inarow +"</b> (სულ არის <b>"+practice_criterion+"</b> დავალება).<p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."}else{
				feedback_text="<p>***</p> <span style='color:red'>არასწორი პასუხია!</span> Ღილაკის ფერი ხილის ფერს უნდა ემთხვეოდეს(ისევე როგორც წინა დავალებაში). Კიდევ ერთხელ სცადეთ!<br>სწორი პასუხები: <b>"+nC_inarow +"</b> (სულ არის <b>"+practice_criterion+"</b> დავალება).<p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."
			}
		 return[feedback_text]},
		show_clickable_nav: true,
		on_finish: function(data){
				
	 	   	},
	};
	var StimLoop_Page3_Practice = {
		timeline: [Page3,Feedback_Page3],
		loop_function: function(data){
			if(item_completed==true){
				return false
			}else{
				return true
			}
		}
	}
	var Page3_Loop_Practice = {
		timeline: [StimLoop_Page3_Practice],
		loop_function: function(data){
		        
		        if(nC_inarow==practice_criterion){
		        	return false;
		        }else{
		        	return true;
		        }

		  }

	}
	var Filler_Page3 = {
		type: 'instructions',
		pages: ["<p>***</p> <b>ძალიან კარგი!</b> <p>ახლა დროა დაიწყოთ დავალება <b>3</b>. (სულ არის  <b>4</b>). <b><br>შეასრულეთ "+(time_limit/1000)+" წამში რაც შეიძლება მეტი დავალება!</b></p><p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."],
		show_clickable_nav: true,
		on_finish: function(data){
				practice = false;
				i = 0;	
				i_color = Math.floor(Math.random()*3)
				button_pressed = Math.floor(Math.random()*color_buttons.length)
				practice = false
				nC_inarow = 0
				startTime = new Date()

				item_completed = false
				nCompleted_Page3 = i
				nErrors_Page3 = 0
				RTs_Page3 = []
				RTs_Page3_correct = []
				RTs_Page3_wrong = []
	 	   	},
	};
	var StimLoop_Page3_Test = {
		timeline: [Page3],
		loop_function: function(data){
			if(item_completed==true){
				return false
			}else{
				return true
			}
		}
	}
	var Page3_Loop_Test = {
		timeline: [StimLoop_Page3_Test],
		loop_function: function(data){
		        
		        if((new Date()-startTime)>=time_limit){
		        	return false;
		        }else{
		        	return true;
		        }

		  }

	}
	var Page3_finalFeedback = {
		type: 'instructions',
		pages: function(){
				mean_RTs = Math.round((averageFx(RTs_Page3)/1000)*100)/100; nCompleted_Page3 = nCompleted_Page3;
				if(RTs_Page3_correct.length==0){mean_RTs_right="არ არის სწორი პასუხები"}else{
					mean_RTs_right_P3 = Math.round((averageFx(RTs_Page3_correct)/1000)*100)/100; 
				}
				if(RTs_Page3_wrong.length==0){mean_RTs_wrong="არასწორი პასუხები არ არის"}else{
					mean_RTs_wrong = Math.round((averageFx(RTs_Page3_wrong)/1000)*100)/100; 
				}
				return["შესრულებული დავალებები: <b>"+nCompleted_Page3+"</b><br>შეცდომების რაოდენობა: <b>"+nErrors_Page3+"</b><br>საშუალო პასუხის დრო(წამები): <b>"+mean_RTs+"</b><br>პასუხის დრო(სწორი მცდელობები): <b>"+mean_RTs_right_P3+" </b><br>პასუხის დრო(არასწორი მცდელობები): <b>"+mean_RTs_wrong+" "]},
		show_clickable_nav: true,
		data: function(){
				return{nCompleted_Page3: nCompleted_Page3, nErrors_Page3: nErrors_Page3, RTs: RTs_Page3}
			},
		on_finish: function(data){
				
	 	   	},
	}

	var Instruction_Page4 = {
		type: 'instructions',
		pages: ["<p>***</p> <b> მშვენიერია!</b> <p> <b>მეოთხე</b> და ასევე <b>საბოლოო დავალებაში</b> ხილი მოცემულია მცდარ ფერში (მაგალითად, წითელი ბანანი) და თქვენი დავალებაა დააჭიროთ სწორი ფერის ღილაკს (მაგალითად, ყვითელს როდესაც წითელი ბანანია ნაჩვენები). <p>***</p>ტესტის დასაწყებად დააწკაპუნეთ <i>გაგრძელება-ზე</i>."],
		show_clickable_nav: true,
		on_finish: function(data){
				i = 0;	
				subsets_practice = [0,1,2,2]
				colors_practice = [0,1,2,3]
				i_subset = subsets_practice[0]
				i_color = colors_practice[0]
				//i_subset = Math.floor(Math.random()*(color_buttons.length-1))
				//i_color = Math.floor(Math.random()*color_buttons.length)
				console.log([i_subset,i_color])
				button_pressed = Math.floor(Math.random()*color_buttons.length)
				practice = true
				nC_inarow = 0
				startTime = new Date()

				item_completed = false
				nCompleted_Page4 = i
				nErrors_Page4 = 0
				RTs_Page4 = []
				RTs_Page4_correct = []
				RTs_Page4_wrong = []
	 	   	},
	};
	var Page4 = {
		    type: 'BRFruit',
			is_html: false, 
			prompt: "რომელია ხილის ნამდვილი ფერი?<p>",
			stimulus: function(){
					return incongruentFruits[i_subset][i_color]
			},
		    choices: color_buttons,
	 	   	on_finish: function(data){
				button_order = data.button_order
				button_pressed = data.button_pressed
				color_correct = data.color_correct
				color_clicked = data.color_clicked
				console.log([color_correct,color_clicked])
				RTs_Page4.push(data.rt)
				if(color_correct==color_clicked){
					// i = counting items = number completed
					i++
					nCompleted_Page4=i
					nC_inarow++
					item_completed = true
					if(practice==false){
						var stim_turned_new = false;
						while(stim_turned_new== false){
							i_subset_next = Math.floor(Math.random()*(color_buttons.length-1))
							i_color_next = Math.floor(Math.random()*color_buttons.length)
							if((i_subset_next!= i_subset)&&(i_color_next!=i_color)){
								i_subset=i_subset_next
								i_color=i_color_next
								stim_turned_new=true
							}
						}
					}else{
						i_subset = subsets_practice[i]
						i_color = colors_practice[i]
					}
					RTs_Page4_correct.push(data.rt)
				}else{
					if(practice==true){i=0}
					nC_inarow = 0
					item_completed = false
					nErrors_Page4++
					RTs_Page4_wrong.push(data.rt)
				}
	 	   	},
		};

	var Feedback_Page4 = {
		type: 'instructions',
		pages: function(){if(item_completed==true){
			feedback_text = "<p>***</p> <span style='color:green'>სწორი პასუხია!</span><br>Თანმიმდევრულად მოცემული სწორი პასუხების რაოდენობა: <b>"+nC_inarow +"</b> (სულ არის <b>"+practice_criterion+"</b> დავალება).<p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."}else{
				feedback_text="<p>***</p> <span style='color:red'>არასწორი პასუხია!</span> Ღილაკის ფერი უნდა ემთხვეოდეს ხილის “ნამდვილ” ფერს (ისე როგორც წინა დავალებებში იყო). Კიდევ ერთხელ სცადეთ!<br>სწორი პასუხები: <b>"+nC_inarow +"</b> (ჯამში <b>"+practice_criterion+"</b> დავალება).<p>***</p>დააწკაპუნეთ <i>გაგრძელება-ზე</i>."
			}
		 return[feedback_text]},
		show_clickable_nav: true,
		on_finish: function(data){
				
	 	   	},
	};
	var StimLoop_Page4_Practice = {
		timeline: [Page4,Feedback_Page4],
		loop_function: function(data){
			if(item_completed==true){
				return false
			}else{
				return true
			}
		}
	}
	var Page4_Loop_Practice = {
		timeline: [StimLoop_Page4_Practice],
		loop_function: function(data){
		        
		        if(nC_inarow==practice_criterion){
		        	return false;
		        }else{
		        	return true;
		        }

		  }

	}
	var Filler_Page4 = {
		type: 'instructions',
		pages: ["<p>***</p> <b>ყოჩაღ!</b> <br>ახლა კი <b>ბოლო დავალება</b>.<b><br>შეასრულეთ "+(time_limit/1000)+" წამში რაც შეიძლება მეტი დავალება!</b></p><p>***</p>დავალების დასაწყებად დააწკაპუნეთ <i>გაგრძელება-ზე</i>."],
		show_clickable_nav: true,
		on_finish: function(data){
				practice = false;
				i = 0;	
				i_subset = Math.floor(Math.random()*(color_buttons.length-1))
				i_color = Math.floor(Math.random()*color_buttons.length)
				button_pressed = Math.floor(Math.random()*color_buttons.length)
				practice = false
				nC_inarow = 0
				startTime = new Date()

				item_completed = false
				nCompleted_Page4 = i
				nErrors_Page4 = 0
				RTs_Page4 = []
				RTs_Page4_correct = []
				RTs_Page4_wrong = []
	 	   	},
	};
	var StimLoop_Page4_Test = {
		timeline: [Page4],
		loop_function: function(data){
			if(item_completed==true){
				return false
			}else{
				return true
			}
		}
	}
	var Page4_Loop_Test = {
		timeline: [StimLoop_Page4_Test],
		loop_function: function(data){
		        
		        if((new Date()-startTime)>=time_limit){
		        	return false;
		        }else{
		        	return true;
		        }

		  }

	}
	var Page4_finalFeedback = {
		type: 'instructions',
		pages: function(){
				mean_RTs = Math.round((averageFx(RTs_Page4)/1000)*100)/100; nCompleted_Page4 = nCompleted_Page4;
				if(RTs_Page4_correct.length==0){mean_RTs_right="არ არის სწორი პასუხები"}else{
					mean_RTs_right_P4 = Math.round((averageFx(RTs_Page4_correct)/1000)*100)/100; 
				}
				if(RTs_Page4_wrong.length==0){mean_RTs_wrong="არასწორი პასუხები არ არის"}else{
					mean_RTs_wrong = Math.round((averageFx(RTs_Page4_wrong)/1000)*100)/100; 
				}
				return["შესრულებული დავალებები: <b>"+nCompleted_Page4+"</b><br>შეცდომების რაოდენობა: <b>"+nErrors_Page4+"</b><br>საშუალო პასუხის დრო(წამები): <b>"+mean_RTs+"</b><br>პასუხის დრო(სწორი მცდელობები): <b>"+mean_RTs_right_P4+" </b><br>პასუხის დრო(არასწორი მცდელობები): <b>"+mean_RTs_wrong+" "]},
		show_clickable_nav: true,
		data: function(){
				return{nCompleted_Page4: nCompleted_Page4, nErrors_Page4: nErrors_Page4, RTs: RTs_Page4}
			},
		on_finish: function(data){
				
	 	   	},
	}

	var Summary_Scoring = {
		type: 'instructions',
		pages: function(){
				predicted_score = (nCompleted_Page1*nCompleted_Page3)/(nCompleted_Page1+nCompleted_Page3)
				predicted_score = Math.round(predicted_score*100)/100
				actual_score = nCompleted_Page4-predicted_score
				actual_score = Math.round(actual_score*100)/100
				interference_score = actual_score-predicted_score
				interference_score = Math.round(interference_score*100)/100
				return["<b>თქვენი შედეგები: </b><p>შესრულებული დავალებები (დავალება 1): <b>"+nCompleted_Page1+"</b><br> შესრულებული დავალებები (დავალება 2): <b>"+nCompleted_Page2+"</b><br> შესრულებული დავალებები (დავალება 3): <b>"+nCompleted_Page3+"</b><br> შესრულებული დავალებები (დავალება 4): <b>"+nCompleted_Page4+"</b><p>პასუხის საშუალო დრო(დავალება 1): <b>"+mean_RTs_right_P1+"</b> წამი<br>პასუხის საშუალო დრო(დავალება 2): <b>"+mean_RTs_right_P2+"</b> წამი<br>პასუხის საშუალო დრო (დავალება 3): <b>"+mean_RTs_right_P3+"</b> წამი<br>პასუხის საშუალო დრო (დავალება 4): <b>"+mean_RTs_right_P4+"</b> წამი<p>მოსალოდნელი შედეგი: <b>"+predicted_score+"</b><br>რეალური შედეგი: <b>"+actual_score+"</b><br>სხვაობა: <b>"+interference_score+""]},
		show_clickable_nav: true,
		data: function(){
				return{nCompleted_Page1: nCompleted_Page1, nCompleted_Page2: nCompleted_Page2, nCompleted_Page3: nCompleted_Page3, nCompleted_Page4: nCompleted_Page4, mean_RTs_right_P1: mean_RTs_right_P1, mean_RTs_right_P2: mean_RTs_right_P2, mean_RTs_right_P3: mean_RTs_right_P3, mean_RTs_right_P4: mean_RTs_right_P4, predicted_score: predicted_score, actual_score: actual_score, interference_score: interference_score}
			},
		on_finish: function(data){
				
	 	   	},
	}

	/*var goodbye = {
			type: 'instructions',
			pages: [function(){return("<h3>Suur t&#228nu vastamise eest!</h3> Kl&#245psa nuppu <i>J&#228tka</i>, et alustada andmete allalaadimist allalaetud failide kausta. Palun saada see fail aadressile: <a href='mailto:seasenselab@gmail.com'>seasenselab@gmail.com</a>  <p>Kui mingil p&#245hjusel allalaadimine ei t&#246&#246ta, siis palun kopeeri ja kleebi ekraanil kuvatud andmed oma valitud tekstifaili ja saada see samuti aadressile <a href='mailto:seasenselab@gmail.com'>seasenselab@gmail.com</a>.<p><b>Igal juhul palun teavita meid oma osalemisest! </li></ul>")}],
			show_clickable_nav: true,	
	};*/
	var goodbye = {
        type: 'instructions',
        pages: ["<h3>მადლობას გიხდით პასუხის გაცემისთვის!</h3> <p>Თქვენი ანონიმური პასუხები ტალინის უნივერსიტეტის სერვერზე შეინახება. <br>Თუკი შეკითხვა გაქვთ კვლევის მიზანთან ან ჩვენ მიერ მონაცემების მართვასთან დაკავშირებით, <br>გთხოვთ გადმოგვიგზავნეთ იმეილი: <a href='mailto:seasenselab@gmail.com'> seasenselab@gmail.com</a>"],
        show_clickable_nav: true
    };



/////////
	jsPsych.init({
		
		timeline: [ welcome, /*informedConsent1, informedConsent2, informedConsent3,*/
					persCode_loop,
					Instruction_Page1, Page1_Loop_Practice, Filler_Page1, Page1_Loop_Test, Page1_finalFeedback,
					Instruction_Page2, Page2_Loop_Practice, Filler_Page2, Page2_Loop_Test, Page2_finalFeedback,
					Instruction_Page3, Page3_Loop_Practice, Filler_Page3, Page3_Loop_Test, Page3_finalFeedback,
					Instruction_Page4, Page4_Loop_Practice, Filler_Page4, Page4_Loop_Test, Page4_finalFeedback,
					Summary_Scoring,
					goodbye
				  ],

	   	fullscreen: false,
	   	on_finish: function() {
					  //jsPsych.data.localSave('myData_sendMeTo_onne.uus@tlu.ee.txt', 'csv');
					  $.post( "http://web.htk.tlu.ee/dinogame" + "/ajax.php?method=save_data", JSON.stringify({"JSON" : jsPsych.data.dataAsJSON(), "CSV" : jsPsych.data.dataAsCSV()}) );
				  }
	});
	
	
		
	</script>
		
</html>
